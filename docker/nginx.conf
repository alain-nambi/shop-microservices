upstream products {
  server products-service:3000;
}

# upstream users {
#   server users-service:3000;
# }

# upstream cart {
#   server cart-service:3000;
# }

# upstream orders {
#   server orders-service:3000;
# }

server {
  listen 80;
  server_name localhost;

  # Health checks
  location = /health {
    return 200 "OK\n";
    add_header Content-Type text/plain;
  }

  # API routes
  location /api/products/ {
    proxy_pass http://products;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # location /api/users/ {
  #   proxy_pass http://users;
  #   proxy_set_header Host $host;
  #   proxy_set_header X-Real-IP $remote_addr;
  # }

  # location /api/cart/ {
  #   proxy_pass http://cart;
  #   proxy_set_header Host $host;
  # }

  # location /api/orders/ {
  #   proxy_pass http://orders;
  #   proxy_set_header Host $host;
  # }

  # # Frontend (stubbed for now)
  # location / {
  #   proxy_pass http://frontend:3001;
  #   proxy_set_header Host $host;
  # }

  # Security headers
  add_header X-Content-Type-Options nosniff;
  add_header X-Frame-Options DENY;
  add_header X-XSS-Protection "1; mode=block";
}